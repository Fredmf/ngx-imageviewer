!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/platform-browser"),require("rxjs")):"function"==typeof define&&define.amd?define("@emazv72/ngx-imageviewer",["exports","@angular/core","@angular/platform-browser","rxjs"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).emazv72=t.emazv72||{},t.emazv72["ngx-imageviewer"]={}),t.ng.core,t.ng.platformBrowser,t.rxjs)}(this,(function(t,e,o,i){"use strict";var r=function(){};function n(t,e,o,i){return void 0===o&&(o=0),void 0===i&&(i=!0),{icon:t,tooltip:e,sortId:o,show:i}}var s=new e.InjectionToken("imageviewer.config"),a={width:800,height:600,bgStyle:"#ECEFF1",scaleStep:.1,rotateStepper:!1,loadingMessage:"Loading...",buttonStyle:{iconFontFamily:"Material Icons",alpha:.5,hoverAlpha:.7,bgStyle:"#000000",iconStyle:"#ffffff",borderStyle:"#000000",borderWidth:0},tooltips:{enabled:!0,bgStyle:"#000000",bgAlpha:.5,textStyle:"#ffffff",textAlpha:.9,padding:15,radius:20},nextPageButton:n(String.fromCharCode(58377),"Next page",0),beforePageButton:n(String.fromCharCode(58376),"Previous page",1),zoomOutButton:n(String.fromCharCode(59648),"Zoom out",0),zoomInButton:n(String.fromCharCode(59647),"Zoom in",1),rotateLeftButton:n(String.fromCharCode(58393),"Rotate left",2),rotateRightButton:n(String.fromCharCode(58394),"Rotate right",3),resetButton:n(String.fromCharCode(59491),"Reset",4)},h=function(){function t(t,e){this.style=e,this.sortId=0,this.hover=!1,this.display=!0,this.drawPosition=null,this.drawRadius=0,this.sortId=t.sortId,this.display=t.show,this.icon=t.icon,this.tooltip=t.tooltip}return t.prototype.onClick=function(t){return alert("no click action set!"),!0},t.prototype.onMouseDown=function(t){return!1},t.prototype.draw=function(t,e,o,i){this.drawPosition={x:e,y:o},this.drawRadius=i,t.save();var r="function"==typeof this.hover?this.hover():this.hover;t.globalAlpha=r?this.style.hoverAlpha:this.style.alpha,t.fillStyle=this.style.bgStyle,t.lineWidth=0,t.beginPath(),t.arc(e,o,i,0,2*Math.PI),t.closePath(),t.fill(),this.style.borderWidth>0&&(t.lineWidth=this.style.borderWidth,t.strokeStyle=this.style.borderStyle,t.stroke()),null!==this.icon&&(t.save(),this.drawIconFont(t,e,o,i),t.restore()),t.restore()},t.prototype.drawIconFont=function(t,e,o,i){t.font=i+"px "+this.style.iconFontFamily,t.fillStyle=this.style.iconStyle;var r=e-t.measureText(this.icon).width/2,n=o+i/2;t.fillText(this.icon,r,n)},t.prototype.isWithinBounds=function(t,e){if(null===this.drawPosition)return!1;var o=Math.abs(this.drawPosition.x-t),i=Math.abs(this.drawPosition.y-e);return o*o+i*i<=this.drawRadius*this.drawRadius},t}(),c=function(){function t(){this.viewport={width:0,height:0,scale:1,rotation:0,x:0,y:0},this.minScale=0,this.maxScale=4,this.currentItem=1,this.totalItem=1,this.showItemsQuantity=!1,this.loaded=!1,this.loading=!1,this.rendering=!1,this.resourceChange=new i.Subject}return t.prototype.resetViewport=function(t){if(this.loaded&&t){var e=u(this.viewport?this.viewport.rotation:0)/90%2!=0,o=e?t.height:t.width,i=e?t.width:t.height;i/this._image.height*this._image.width<=o?this.viewport.scale=i/this._image.height:this.viewport.scale=o/this._image.width,this.minScale=this.viewport.scale/4,this.maxScale=4*this.viewport.scale,this.viewport.width=this._image.width*this.viewport.scale,this.viewport.height=this._image.height*this.viewport.scale,this.viewport.x=(t.width-this.viewport.width)/2,this.viewport.y=(t.height-this.viewport.height)/2}},t.prototype.draw=function(t,e,o,i){t.clearRect(0,0,o.width,o.height),t.fillStyle=e.bgStyle,t.fillRect(0,0,o.width,o.height),!this.loading&&this.loaded?(t.translate(this.viewport.x+this.viewport.width/2,this.viewport.y+this.viewport.height/2),t.rotate(this.viewport.rotation*Math.PI/180),t.scale(this.viewport.scale,this.viewport.scale),t.drawImage(this._image,-this._image.width/2,-this._image.height/2)):(t.fillStyle="#333",t.font="25px Verdana",t.textAlign="center",t.fillText(e.loadingMessage||"Loading...",o.width/2,o.height/2)),i(t,e,o)},t.prototype.onResourceChange=function(){return this.resourceChange.asObservable()},t}();function u(t){return(Math.trunc(t/90)+(Math.trunc(t%90)>45?1:0))%4*90}
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var l=function(t,e){return(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)};function p(t,e){function o(){this.constructor=t}l(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}Object.create;Object.create;var g=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return p(e,t),e.prototype.setUp=function(){this.loadResource()},e.prototype.loadResource=function(){var t=this;this.loading=!0,this._image=new Image,this._image.addEventListener("load",(function(e){t.loaded=!0,t.loading=!1,t.resourceChange.next()}),!1),this._image.src=this.src},e}(c),f=function(){function t(){this._cache=[]}return Object.defineProperty(t.prototype,"cache",{get:function(){return this._cache},enumerable:!1,configurable:!0}),t.prototype.getCache=function(t,e){return this.cache.find((function(o){return o.url===t&&o.page===e}))},t.prototype.getImage=function(t,e){var o=this.getCache(t,e);return o?o.image:null},t.prototype.saveImage=function(t,e,o){var i=this.getCache(t,e);i?i.image=o:this.cache.push({url:t,page:e,image:o})},t.prototype.disposeCache=function(){this.cache.forEach((function(t){return URL.revokeObjectURL(t.image.src)})),this._cache=[]},t}();f.ɵprov=e.ɵɵdefineInjectable({factory:function(){return new f},token:f,providedIn:"root"}),f.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],f.ctorParameters=function(){return[]};var d=function(t){function e(e){var o=t.call(this)||this;return o._imageCache=e,"undefined"!=typeof window&&"Worker"in window&&pdfjsLib&&pdfjsLib.GlobalWorkerOptions&&!pdfjsLib.GlobalWorkerOptions.workerSrc&&(pdfjsLib.GlobalWorkerOptions.workerSrc=pdfjsWorker),o.showItemsQuantity=!0,o}return p(e,t),e.prototype.setUp=function(){var t=this;if(!t.loading&&t.src){var e=pdfjsLib.getDocument(t.src);t.loading=!0,t.currentItem=1,e.then((function(e){t._pdf=e,t.totalItem=e.numPages,t.loaded=!0,t.loadResource()}),(function(t){console.error(t)}))}},e.prototype.loadResource=function(){var t=this;if(t.loaded){t.loaded=!1;var e=t.src,o=t.currentItem;t._pdf.getPage(o).then((function(i){t._page=i,t.loadImage(e,o,(function(){t.loaded=!0,t.loading=!1,t._pendingReload?(t._pendingReload=!1,t.loadResource()):t.resourceChange.next()}))}))}else t._pendingReload=!0},e.prototype.loadImage=function(t,e,o){var i=this,r=i._imageCache.getImage(t,e);if(r)return i._image=r,void o();var n=document.createElement("canvas"),s=n.getContext("2d"),a=i._page.getViewport(2);n.width=a.width,n.height=a.height;var h={canvasContext:s,viewport:a};i._page.render(h).then((function(){n.toBlob((function(r){var n=new Image;n.onload=o,n.src=URL.createObjectURL(r),i._imageCache.saveImage(t,e,n),i._image=n}))}))},e}(c),_=function(){function t(t,e,o,i){this._sanitizer=t,this._renderer=e,this._imageCache=o,this.config=i,this._dirty=!0,this._buttons=[],this._currentTooltip=null,this._touchStartState={},this._listenDestroyList=[],this.config=this.extendsDefaultConfig(i),this._nextPageButton=new h(this.config.nextPageButton,this.config.buttonStyle),this._beforePageButton=new h(this.config.beforePageButton,this.config.buttonStyle),this._zoomOutButton=new h(this.config.zoomOutButton,this.config.buttonStyle),this._zoomInButton=new h(this.config.zoomInButton,this.config.buttonStyle),this._rotateLeftButton=new h(this.config.rotateLeftButton,this.config.buttonStyle),this._rotateRightButton=new h(this.config.rotateRightButton,this.config.buttonStyle),this._resetButton=new h(this.config.resetButton,this.config.buttonStyle),this._buttons=[this._zoomOutButton,this._zoomInButton,this._rotateLeftButton,this._rotateRightButton,this._resetButton].filter((function(t){return t.display})).sort((function(t,e){return t.sortId-e.sortId}))}return Object.defineProperty(t.prototype,"src",{get:function(){return this._src},set:function(t){t!==this._src&&(this._src=t,this.setUpResource())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"filetype",{get:function(){return this._filetype},set:function(t){t!==this._filetype&&(this._filetype=t,this.setUpResource())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width},set:function(t){t!==this._width&&(this._width=t,this._canvas&&(this._canvas.width=this._width),this.resetImage())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},set:function(t){t!==this._height&&(this._height=t,this._canvas&&(this._canvas.height=this._height),this.resetImage())},enumerable:!1,configurable:!0}),t.prototype.ngAfterViewInit=function(){var t=this;this._canvas=this.canvasRef.nativeElement,this._context=this._canvas.getContext("2d"),this._canvas.width=this.width||this.config.width,this._canvas.height=this.height||this.config.height,this._nextPageButton.onClick=function(e){return t.nextPage(),!1},this._beforePageButton.onClick=function(e){return t.previousPage(),!1},this._zoomOutButton.onClick=function(e){return t.zoomOut(),!1},this._zoomInButton.onClick=function(e){return t.zoomIn(),!1},this._rotateLeftButton.onClick=function(e){return t.rotateLeft(),!1},this._rotateRightButton.onClick=function(e){return t.rotateRight(),!1},this._resetButton.onClick=function(e){return t.resetImage(),!1},this.addEventListeners(),this.updateCanvas()},t.prototype.ngOnDestroy=function(){this._listenDestroyList.forEach((function(t){"function"==typeof t&&t()})),this._imageCache.disposeCache()},t.prototype.setUpResource=function(){var t=this;!this.isImage(this.src)||this._resource&&this._resource instanceof g?!this.isPdf(this.src)||this._resource&&this._resource instanceof d||(this._resourceChangeSub&&this._resourceChangeSub.unsubscribe(),this._pdfResource||(this._pdfResource=new d(this._imageCache)),this._resource=this._pdfResource):(this._resourceChangeSub&&this._resourceChangeSub.unsubscribe(),this._imageResource||(this._imageResource=new g),this._resource=this._imageResource),this._resource&&(this._resource.src=this.src instanceof File?URL.createObjectURL(this.src):this.src,this._resourceChangeSub=this._resource.onResourceChange().subscribe((function(){t.updateCanvas(),t.src instanceof File&&URL.revokeObjectURL(t._resource.src)})),this._resource.setUp(),this.resetImage(),this._context&&this.updateCanvas())},t.prototype.onTap=function(t){var e={x:t.pageX,y:t.pageY},o=this.getUIElement(this.screenToCanvasCentre(e));null!==o&&o.onClick(t)},t.prototype.onTouchEnd=function(){this._touchStartState.viewport=void 0,this._touchStartState.scale=void 0,this._touchStartState.rotate=void 0},t.prototype.processTouchEvent=function(t){this._touchStartState.viewport||(this._touchStartState.viewport=Object.assign({},this._resource.viewport));var e=this._resource.viewport;e.x=this._touchStartState.viewport.x+t.deltaX,e.y=this._touchStartState.viewport.y+t.deltaY,this._touchStartState.scale||(this._touchStartState.scale=this._resource.viewport.scale);var o=this._touchStartState.scale*t.scale;if(e.scale=o>this._resource.maxScale?this._resource.maxScale:o<this._resource.minScale?this._resource.minScale:o,this._touchStartState.rotate||(this._touchStartState.rotate={rotation:e.rotation,startRotate:t.rotation}),0!==t.rotation){var i=this._touchStartState.rotate.rotation+t.rotation-this._touchStartState.rotate.startRotate;e.rotation=this.config.rotateStepper?u(i):i}this._dirty=!0},t.prototype.addEventListeners=function(){var t=this;this._listenDestroyList.push(this._renderer.listen(this._canvas,"DOMMouseScroll",(function(e){return t.onMouseWheel(e)}))),this._listenDestroyList.push(this._renderer.listen(this._canvas,"mousewheel",(function(e){return t.onMouseWheel(e)}))),this._listenDestroyList.push(this._renderer.listen(this._canvas,"mousemove",(function(e){return t.checkTooltipActivation(t.screenToCanvasCentre({x:e.clientX,y:e.clientY}))})))},t.prototype.onMouseWheel=function(t){t||(t=event),t.preventDefault(),t.detail<0||t.wheelDelta>0?this.zoomIn():this.zoomOut()},t.prototype.checkTooltipActivation=function(t){this.getUIElements().forEach((function(t){return t.hover=!1}));var e=this.getUIElement(t),o=this._currentTooltip;null!==e&&(void 0!==e.hover&&(e.hover=!0),void 0!==e.tooltip&&(this._currentTooltip=e.tooltip)),o!==this._currentTooltip&&(this._dirty=!0)},t.prototype.nextPage=function(){this._resource&&(this._resource.currentItem>=this._resource.totalItem||(this._resource.currentItem<1&&(this._resource.currentItem=0),this._resource.currentItem++,this._resource.loadResource(),this._dirty=!0))},t.prototype.previousPage=function(){this._resource&&(this._resource.currentItem<=1||(this._resource.currentItem>this._resource.totalItem&&(this._resource.currentItem=this._resource.totalItem+1),this._resource.currentItem--,this._resource.loadResource(),this._dirty=!0))},t.prototype.zoomIn=function(){if(this._resource){var t=this._resource.viewport.scale*(1+this.config.scaleStep);this._resource.viewport.scale=t>this._resource.maxScale?this._resource.maxScale:t,this._dirty=!0}},t.prototype.zoomOut=function(){if(this._resource){var t=this._resource.viewport.scale*(1-this.config.scaleStep);this._resource.viewport.scale=t<this._resource.minScale?this._resource.minScale:t,this._dirty=!0}},t.prototype.rotateLeft=function(){if(this._resource){var t=this._resource.viewport;t.rotation=0===t.rotation?270:t.rotation-90,this._dirty=!0}},t.prototype.rotateRight=function(){if(this._resource){var t=this._resource.viewport;t.rotation=270===t.rotation?0:t.rotation+90,this._dirty=!0}},t.prototype.resetImage=function(){this._resource&&(this._resource.resetViewport(this._canvas),this._dirty=!0)},t.prototype.updateCanvas=function(){this.resetImage(),this.render()},t.prototype.render=function(){var t=this,e=this;if(this._dirty&&this._resource){this._dirty=!1;var o=this._context;o.save(),this._resource.draw(o,this.config,this._canvas,(function(){o.restore(),e._resource.loaded&&(t.drawButtons(o),t._resource.showItemsQuantity&&t.drawPaginator(o))}))}requestAnimationFrame((function(){return t.render()}))},t.prototype.drawButtons=function(t){for(var e=this.config.tooltips.padding,o=this.config.tooltips.radius,i=2*o+e,r=this._canvas.width-o-e,n=this._canvas.height-o-e,s=0;s<this._buttons.length;s++)this._buttons[s].draw(t,r,n-i*s,o);if(null!==this._currentTooltip&&this._canvas.width>500){t.save();var a=o;t.font=a+"px sans-serif";var h=t.measureText(this._currentTooltip).width+e,c=.7*a+e,u=this._canvas.width-(2*o+2*e)-h,l=this._canvas.height-c-e,p=u+.5*e,g=this._canvas.height-1.5*e;t.globalAlpha=this.config.tooltips.bgAlpha,t.fillStyle=this.config.tooltips.bgStyle,this.drawRoundRectangle(t,u,l,h,c,8,!0,!1),t.globalAlpha=this.config.tooltips.textAlpha,t.fillStyle=this.config.tooltips.textStyle,t.fillText(this._currentTooltip,p,g),t.restore()}},t.prototype.drawPaginator=function(t){var e=this.config.tooltips.padding,o=this.config.tooltips.radius,i=(this._canvas.width-50)/2-o-e,r=this._canvas.width/2,n=(this._canvas.width+50)/2+o+e,s=this._canvas.height-o-e,a=this._resource.currentItem+"/"+this._resource.totalItem;t.save(),this._beforePageButton.draw(t,i,s,o),this._nextPageButton.draw(t,n,s,o),t.restore(),t.save(),t.font="25px Verdana",t.textAlign="center",t.fillText(a,r,this._canvas.height-e-12.5,50),t.restore()},t.prototype.drawRoundRectangle=function(t,e,o,i,r,n,s,a){n="number"==typeof n?n:5,s="boolean"!=typeof s||s,a="boolean"==typeof a&&a,t.beginPath(),t.moveTo(e+n,o),t.lineTo(e+i-n,o),t.quadraticCurveTo(e+i,o,e+i,o+n),t.lineTo(e+i,o+r-n),t.quadraticCurveTo(e+i,o+r,e+i-n,o+r),t.lineTo(e+n,o+r),t.quadraticCurveTo(e,o+r,e,o+r-n),t.lineTo(e,o+n),t.quadraticCurveTo(e,o,e+n,o),t.closePath(),s&&t.fill(),a&&t.stroke()},t.prototype.extendsDefaultConfig=function(t){var e=a,o=Object.assign({},e,t);return t.buttonStyle&&(o.buttonStyle=Object.assign(e.buttonStyle,t.buttonStyle)),t.tooltips&&(o.tooltips=Object.assign(e.tooltips,t.tooltips)),t.nextPageButton&&(o.nextPageButton=Object.assign(e.nextPageButton,t.nextPageButton)),t.beforePageButton&&(o.beforePageButton=Object.assign(e.beforePageButton,t.beforePageButton)),t.zoomOutButton&&(o.zoomOutButton=Object.assign(e.zoomOutButton,t.zoomOutButton)),t.zoomOutButton&&(o.zoomOutButton=Object.assign(e.zoomOutButton,t.zoomOutButton)),t.zoomInButton&&(o.zoomInButton=Object.assign(e.zoomInButton,t.zoomInButton)),t.rotateLeftButton&&(o.rotateLeftButton=Object.assign(e.rotateLeftButton,t.rotateLeftButton)),t.rotateRightButton&&(o.rotateRightButton=Object.assign(e.rotateRightButton,t.rotateRightButton)),t.resetButton&&(o.resetButton=Object.assign(e.resetButton,t.resetButton)),o},t.prototype.screenToCanvasCentre=function(t){var e=this._canvas.getBoundingClientRect();return{x:t.x-e.left,y:t.y-e.top}},t.prototype.getUIElements=function(){var t=this._buttons.slice();return t.push(this._nextPageButton),t.push(this._beforePageButton),t},t.prototype.getUIElement=function(t){var e=this.getUIElements().filter((function(e){return e.isWithinBounds(t.x,t.y)}));return e.length>0?e[0]:null},t.prototype.isImage=function(t){return!(!this._filetype||"image"!==this._filetype.toLowerCase())||v(t,"\\.(png|jpg|jpeg|gif)|image/png")},t.prototype.isPdf=function(t){return!(!this._filetype||"pdf"!==this._filetype.toLowerCase())||v(t,"\\.(pdf)|application/pdf")},t}();function v(t,e){return!!t&&null!==(t instanceof File?t.name:t).toLowerCase().match(e)}_.decorators=[{type:e.Component,args:[{selector:"ngx-imageviewer",template:'\n    <canvas #imageContainer [width]="width" [height]="height"\n      (click)="onTap($event)" (pinchin)="processTouchEvent($event)" (pinchout)="processTouchEvent($event)"\n      (panmove)="processTouchEvent($event)" (panend)="onTouchEnd()" (rotatemove)="processTouchEvent($event)"\n      (rotateend)="onTouchEnd()">\n    </canvas>\n  ',styles:["\n    :host { display: block }\n    :host canvas { margin: 0 auto; display: block }\n    [hidden] { display: none !important }\n  "]}]}],_.ctorParameters=function(){return[{type:o.DomSanitizer},{type:e.Renderer2},{type:f},{type:r,decorators:[{type:e.Inject,args:[s]}]}]},_.propDecorators={src:[{type:e.Input,args:["src"]}],filetype:[{type:e.Input,args:["filetype"]}],width:[{type:e.Input,args:["width"]}],height:[{type:e.Input,args:["height"]}],canvasRef:[{type:e.ViewChild,args:["imageContainer",{static:!1}]}]};var y=a,m=function(){};m.decorators=[{type:e.NgModule,args:[{providers:[{provide:s,useValue:y}],declarations:[_],exports:[_]}]}],t.IMAGEVIEWER_CONFIG=s,t.ImageViewerComponent=_,t.ImageViewerConfig=r,t.ImageViewerModule=m,t.createButtonConfig=n,t.ɵa=a,t.ɵb=f,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=emazv72-ngx-imageviewer.umd.min.js.map